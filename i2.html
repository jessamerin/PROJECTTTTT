<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ExchangeEase | Survival Dashboard</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --primary: #4f46e5;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --bg: #f1f5f9;
            --glass: rgba(255, 255, 255, 0.9);
        }

        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            background: var(--bg); 
            margin: 0; 
            color: #1e293b; 
            height: 100vh;
            overflow: hidden;
        }

        /* --- Global Layout --- */
        .app-shell {
            display: grid;
            grid-template-columns: 300px 1fr 340px;
            height: 100vh;
            gap: 20px;
            padding: 20px;
            box-sizing: border-box;
        }

        /* --- Sidebar Styling (Glassmorphism) --- */
        .sidebar {
            background: white; 
            border-radius: 20px;
            padding: 24px; 
            overflow-y: auto;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
        }

        .widget {
            background: #f8fafc; border-radius: 12px; padding: 15px; margin-bottom: 20px;
            border: 1px solid #e2e8f0;
        }

        .widget-title { font-size: 0.75rem; font-weight: 800; text-transform: uppercase; color: #64748b; margin-bottom: 12px; display: block; }

        /* Currency Calc */
        .calc-row { display: flex; align-items: center; gap: 10px; margin-top: 8px; }
        .calc-row input { width: 100%; border: 1px solid #cbd5e1; padding: 8px; border-radius: 6px; outline: none; }

        /* SOS Button */
        .sos-btn {
            background: var(--danger); color: white; border: none; width: 100%; padding: 15px;
            border-radius: 12px; font-weight: 800; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px;
            box-shadow: 0 4px 14px rgba(239, 68, 68, 0.4); transition: 0.2s;
        }
        .sos-btn:active { transform: scale(0.95); }

        /* --- Center: Map in a Box --- */
        .main-content {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .map-box {
            flex-grow: 1;
            background: white;
            border-radius: 24px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1);
            border: 4px solid white;
        }

        #map { height: 100%; width: 100%; }
        
        .map-search {
            position: absolute; top: 15px; left: 15px; right: 15px;
            z-index: 1000;
        }
        .map-search input {
            width: 100%; padding: 12px 20px; border-radius: 12px; border: 1px solid #e2e8f0;
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1); outline: none; font-size: 0.9rem;
        }

        /* --- Right Sidebar Items --- */
        .feed-item {
            padding: 12px; border-radius: 10px; border: 1px solid #f1f5f9; margin-bottom: 12px; transition: 0.2s;
            background: #f8fafc;
        }
        .feed-item:hover { border-color: var(--primary); background: #f5f3ff; }

        .tag { font-size: 0.65rem; font-weight: 800; padding: 3px 8px; border-radius: 4px; text-transform: uppercase; margin-bottom: 5px; display: inline-block; }
        .tag-job { background: #e0e7ff; color: #3730a3; }
        .tag-guide { background: #dcfce7; color: #166534; }

        .avatar-circle { width: 30px; height: 30px; border-radius: 50%; background: var(--primary); color: white; display: flex; align-items: center; justify-content: center; font-size: 0.7rem; }

        /* Commute Tracker */
        .commute-card {
            border-left: 4px solid var(--primary);
            padding-left: 10px;
            margin-bottom: 10px;
        }

        /* Mobile View Fallback */
        @media (max-width: 1100px) {
            .app-shell { grid-template-columns: 1fr; overflow-y: auto; height: auto; }
            .sidebar { height: auto; }
            .map-box { height: 400px; }
        }
    </style>
</head>
<body>

    <div class="app-shell">
        
        <!-- LEFT: SURVIVAL ESSENTIALS -->
        <aside class="sidebar utility-sidebar">
            <div style="margin-bottom: 30px;">
                <h2 style="color:var(--primary); font-weight: 900; margin:0;">üåç ExchangeEase</h2>
                <p style="font-size:0.8rem; color:#64748b;" id="currentHubDisplay">Berlin Hub ‚Ä¢ V2.0</p>
            </div>

            <button class="sos-btn" onclick="triggerSOS()">
                <i class="fas fa-bullhorn"></i> SEND SOS ALERT
            </button>

            <div class="widget" style="margin-top:20px;">
                <span class="widget-title"><i class="fas fa-coins"></i> Currency Calc (<span id="localCurrencyCode">EUR</span>)</span>
                <div class="calc-row">
                    <input type="number" id="usdAmount" value="100" oninput="convert()">
                    <span>USD</span>
                </div>
                <div class="calc-row">
                    <input type="number" id="localAmount" readonly>
                    <span id="targetCurrencyLabel">EUR</span>
                </div>
                <p style="font-size:0.65rem; color:#94a3b8; margin-top:8px;" id="rateText">*Live rate: 1 USD = 0.92 EUR</p>
            </div>

            <div class="widget">
                <span class="widget-title"><i class="fas fa-ambulance"></i> Emergency Services</span>
                <div style="font-size:0.85rem;" id="emergencyList">
                    <div style="display:flex; justify-content:space-between; margin-bottom:5px;"><span>Police</span> <b class="num-police">110</b></div>
                    <div style="display:flex; justify-content:space-between; margin-bottom:5px;"><span>Medical</span> <b class="num-med">112</b></div>
                    <div style="display:flex; justify-content:space-between;"><span>Women SOS</span> <b class="num-campus">1091</b></div>
                </div>
            </div>

            <div class="widget">
                <span class="widget-title"><i class="fas fa-bus"></i> Live Commute</span>
                <div id="commuteList">
                    <!-- Dynamic Transit -->
                </div>
            </div>
        </aside>

        <!-- CENTER: MAP BOX -->
        <main class="main-content">
            <div class="map-box">
                <div class="map-search">
                    <input type="text" id="citySearch" placeholder="Search a location (Delhi, Paris, London, Tokyo)..." onkeydown="if(event.key==='Enter') searchLoc()">
                </div>
                <div id="map"></div>
            </div>
            
            <!-- Quick Status Bar -->
            <div style="display: flex; gap: 15px;">
                <div class="widget" style="flex: 1; margin: 0; display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-cloud-sun" style="color: var(--warning)"></i>
                    <span id="weatherText">Berlin: 12¬∞C, Overcast</span>
                </div>
                <div class="widget" style="flex: 1; margin: 0; display: flex; align-items: center; gap: 10px;">
                    <i class="fas fa-signal" style="color: var(--success)"></i>
                    <span>Network: Stable (5G)</span>
                </div>
            </div>
        </main>

        <!-- RIGHT: GIGS & GUIDES -->
        <aside class="sidebar feed-sidebar">
            <h3 style="margin-top:0;">Nearby Network</h3>
            
            <div id="gigFeed">
                <span class="widget-title">Gigs & Handovers</span>
                <div class="feed-item">
                    <span class="tag tag-job">Part-Time Job</span><br>
                    <strong>English Tutor Needed</strong>
                    <p style="font-size:0.8rem; color:#64748b; margin:5px 0;">$20/hr at Campus Library. 2 hours/week.</p>
                </div>
            </div>

            <div id="guideFeed" style="margin-top:20px;">
                <span class="widget-title">Available Guides</span>
                <div class="feed-item" id="activeGuideCard">
                    <span class="tag tag-guide">Active Now</span><br>
                    <div style="display:flex; align-items:center; gap:10px;">
                        <div id="guideAvatar" class="avatar-circle">L</div>
                        <strong id="guideName">Lukas (Year 3)</strong>
                    </div>
                    <small id="guideSpecialty" style="color:#64748b;">Specialty: Visa & Banking help</small>
                </div>
            </div>

            <button class="sos-btn" style="background:var(--primary); margin-top:20px;" onclick="addEntry()">
                + Post Gig / Become Guide
            </button>
        </aside>

    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        const locationData = {
            "berlin": {
                name: "Berlin Hub",
                currency: "EUR",
                rate: 0.92,
                police: "110",
                med: "112",
                womenSos: "030 19222",
                transit: ["U-Bahn U2 - 3 mins", "Bus 200 - 8 mins"],
                weather: "Berlin: 12¬∞C, Overcast",
                guides: [{name: "Lukas", specialty: "Visa & Banking"}]
            },
            "delhi": {
                name: "Delhi Hub",
                currency: "INR",
                rate: 83.15,
                police: "100",
                med: "102",
                womenSos: "1091",
                transit: ["Yellow Line (Metro) - 2 mins", "Auto Rickshaw - High Demand"],
                weather: "Delhi: 32¬∞C, Sunny",
                guides: [{name: "Aarav", specialty: "PG & Mess Locators"}]
            },
            "paris": {
                name: "Paris Hub",
                currency: "EUR",
                rate: 0.92,
                police: "17",
                med: "15",
                womenSos: "3919",
                transit: ["RER B - 2 mins", "Metro 4 - 5 mins"],
                weather: "Paris: 15¬∞C, Light Rain",
                guides: [{name: "Sophie", specialty: "Housing Hacks"}]
            },
            "london": {
                name: "London Hub",
                currency: "GBP",
                rate: 0.79,
                police: "999",
                med: "999",
                womenSos: "0808 2000 247",
                transit: ["Piccadilly Line - 1 min", "Bus 38 - 4 mins"],
                weather: "London: 10¬∞C, Foggy",
                guides: [{name: "James", specialty: "Internship Guru"}]
            }
        };

        let currentRate = 0.92;

        const map = L.map('map', { zoomControl: false }).setView([52.52, 13.40], 13);
        L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png').addTo(map);

        function updateDashboard(cityKey) {
            const data = locationData[cityKey.toLowerCase()] || locationData["berlin"];
            
            document.getElementById('currentHubDisplay').innerText = `${data.name} ‚Ä¢ V2.0`;
            document.getElementById('localCurrencyCode').innerText = data.currency;
            document.getElementById('targetCurrencyLabel').innerText = data.currency;
            document.getElementById('weatherText').innerText = data.weather;
            
            currentRate = data.rate;
            document.getElementById('rateText').innerText = `*Live rate: 1 USD = ${data.rate} ${data.currency}`;
            
            document.querySelector('.num-police').innerText = data.police;
            document.querySelector('.num-med').innerText = data.med;
            document.querySelector('.num-campus').innerText = data.womenSos;
            
            const transitCont = document.getElementById('commuteList');
            transitCont.innerHTML = data.transit.map(t => `
                <div class="commute-card">
                    <div style="font-size:0.85rem; font-weight:700;">${t.split(' - ')[0]}</div>
                    <div style="font-size:0.75rem; color:var(--success);">${t.split(' - ')[1]}</div>
                </div>
            `).join('');

            const guide = data.guides[0];
            document.getElementById('guideName').innerText = `${guide.name} (Year 3)`;
            document.getElementById('guideAvatar').innerText = guide.name[0];
            document.getElementById('guideSpecialty').innerText = `Specialty: ${guide.specialty}`;

            convert();
        }

        function convert() {
            const usd = document.getElementById('usdAmount').value;
            document.getElementById('localAmount').value = (usd * currentRate).toFixed(2);
        }

        function triggerSOS() {
            const confirmSOS = confirm("TRIGGER EMERGENCY SOS? Your GPS coordinates will be sent to the local hub authorities.");
            if(confirmSOS) {
                alert("Emergency Alert Sent! Local support is being notified.");
            }
        }

        async function searchLoc() {
            const val = document.getElementById('citySearch').value;
            const res = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${val}`);
            const data = await res.json();
            
            if(data.length > 0) {
                const lat = data[0].lat;
                const lon = data[0].lon;
                map.flyTo([lat, lon], 13);

                const lowerVal = val.toLowerCase();
                if(lowerVal.includes('delhi') || lowerVal.includes('india')) updateDashboard('delhi');
                else if(lowerVal.includes('paris')) updateDashboard('paris');
                else if(lowerVal.includes('london')) updateDashboard('london');
                else if(lowerVal.includes('berlin')) updateDashboard('berlin');
            }
        }

        function addEntry() {
            const title = prompt("Enter Gig Title or Guide Skill:");
            if(title) {
                const div = document.createElement('div');
                div.className = 'feed-item';
                div.innerHTML = `<span class="tag tag-job">New</span><br><strong>${title}</strong><p style="font-size:0.8rem; color:#64748b;">Just posted locally.</p>`;
                document.getElementById('gigFeed').prepend(div);
            }
        }

        window.onload = () => { 
            updateDashboard('berlin');
            setTimeout(() => { map.invalidateSize(); }, 400); 
        };
    </script>
</body>
</html>