<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ExchangeEase | Global Student OS</title>
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --primary: #4f46e5;
            --secondary: #10b981;
            --accent: #f59e0b;
            --danger: #f43f5e;
            --bg: #f8fafc;
            --card: #ffffff;
        }

        body { font-family: 'Inter', system-ui, sans-serif; background: var(--bg); margin: 0; color: #1e293b; overflow-x: hidden; }

        /* --- Header & Nav --- */
        nav {
            background: white; padding: 1rem 5%; border-bottom: 1px solid #e2e8f0;
            display: flex; justify-content: space-between; align-items: center;
            position: sticky; top: 0; z-index: 1000;
        }
        .logo { font-weight: 800; font-size: 1.5rem; color: var(--primary); letter-spacing: -0.5px; }

        /* --- Grid Layout --- */
        .dashboard {
            display: grid; grid-template-columns: 280px 1fr 340px;
            gap: 20px; max-width: 1500px; margin: 20px auto; padding: 0 20px;
        }

        .glass-card {
            background: var(--card); border-radius: 16px; padding: 20px;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); border: 1px solid #e2e8f0;
        }

        /* --- Map Integration --- */
        .map-wrapper { position: relative; height: 500px; border-radius: 16px; overflow: hidden; border: 1px solid #e2e8f0; }
        #map { height: 100%; width: 100%; z-index: 1; }
        
        .map-overlay-search {
            position: absolute; top: 20px; left: 50%; transform: translateX(-50%);
            z-index: 1000; display: flex; gap: 10px; width: 80%; max-width: 500px;
            background: white; padding: 10px; border-radius: 50px; box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }
        .map-overlay-search input { flex: 1; border: none; outline: none; padding-left: 15px; font-size: 0.95rem; }
        .map-overlay-search button { background: var(--primary); color: white; border: none; padding: 10px 25px; border-radius: 50px; cursor: pointer; font-weight: 700; }

        /* --- Student Systems Feed --- */
        .system-title { font-size: 1.1rem; font-weight: 800; margin-bottom: 15px; display: flex; align-items: center; gap: 10px; }
        .feed-item {
            padding: 15px; border-radius: 12px; background: #f1f5f9; margin-bottom: 12px; border: 1px solid #e2e8f0;
        }
        .tag { font-size: 0.65rem; font-weight: 900; padding: 3px 8px; border-radius: 6px; text-transform: uppercase; margin-bottom: 8px; display: inline-block; }
        .tag-handover { background: #dcfce7; color: #166534; } /* Blue/Green: Asset transfer */
        .tag-gig { background: #e0e7ff; color: #3730a3; }     /* Purple: Micro-tasks */
        .tag-hack { background: #fef3c7; color: #92400e; }    /* Yellow: Tips */

        .btn-action { width: 100%; padding: 12px; border: none; border-radius: 10px; background: var(--primary); color: white; font-weight: 700; cursor: pointer; transition: 0.2s; }
        .btn-action:hover { opacity: 0.9; transform: translateY(-1px); }

        @media (max-width: 1100px) {
            .dashboard { grid-template-columns: 1fr; }
            .side-nav { display: none; }
        }
    </style>
</head>
<body>

    <nav>
        <div class="logo">üåç ExchangeEase</div>
        <div style="display:flex; align-items:center; gap:20px;">
            <div id="weather" style="font-size: 0.85rem; font-weight: 700; color: #64748b;"><i class="fas fa-location-arrow"></i> Finding Loc...</div>
            <button class="btn-action" style="width:auto; background:var(--danger);" onclick="alert('Sending current coordinates to local emergency services...')">EMERGENCY SOS</button>
        </div>
    </nav>

    <div class="dashboard">
        
        <aside class="side-nav">
            <div class="glass-card">
                <h3 class="system-title"><i class="fas fa-tools"></i> Exchange Tools</h3>
                
                <div class="feed-item">
                    <strong>Currency Swap</strong>
                    <div style="display:flex; justify-content:space-between; margin-top:10px; align-items:center;">
                        <input type="number" value="100" style="width:60px; padding:5px; border-radius:5px; border:1px solid #ddd;">
                        <small>USD ‚ûî EUR</small>
                        <strong style="color:var(--primary)">92.50</strong>
                    </div>
                </div>

                <div class="feed-item">
                    <strong>Transit Alert</strong>
                    <p style="font-size:0.8rem; margin:5px 0;">Bus 402 arriving in <b>4 mins</b></p>
                    <div style="height:4px; width:100%; background:#ddd; border-radius:2px;"><div style="width:70%; height:100%; background:var(--secondary); border-radius:2px;"></div></div>
                </div>

                <button class="btn-action" style="background:#f1f5f9; color:var(--primary); margin-top:10px;">View Campus Map</button>
            </div>
        </aside>

        <main>
            <div class="map-wrapper">
                <div class="map-overlay-search">
                    <input type="text" id="citySearch" placeholder="Search for your next exchange city...">
                    <button onclick="searchCity()">Explore</button>
                </div>
                <div id="map"></div>
            </div>
            
            <div style="margin-top:20px; text-align:center;">
                <p style="color:#64748b; font-size:0.9rem;"><i class="fas fa-users"></i> Showing <b>42 Verified Mentors</b> in this region.</p>
            </div>
        </main>

        <aside>
            <div class="glass-card">
                <h3 class="system-title"><i class="fas fa-bolt"></i> Survival Feed</h3>
                <div id="exchangeFeed">
                    <div class="feed-item">
                        <span class="tag tag-handover">Lease Handover</span>
                        <strong>Studio near University</strong>
                        <p style="font-size:0.85rem; color:#475569;">I'm finishing my exchange. Transferring my lease for $600/mo. Perfect for new arrivals.</p>
                    </div>

                    <div class="feed-item">
                        <span class="tag tag-gig">Micro-Gig</span>
                        <strong>Native Translator Needed</strong>
                        <p style="font-size:0.85rem; color:#475569;">Need help at the registration office tomorrow. 1 hour. Will pay $20 or buy lunch!</p>
                    </div>

                    <div class="feed-item">
                        <span class="tag tag-hack">Exchange Hack</span>
                        <strong>Free Museum Sundays</strong>
                        <p style="font-size:0.85rem; color:#475569;">Pro tip: Use your ISIC card here on Sundays for free entry to the Science Gallery.</p>
                    </div>
                </div>
                <button class="btn-action" onclick="postToFeed()">+ Post a Request/Hack</button>
            </div>
        </aside>

    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // Initialize Map
        const map = L.map('map', { zoomControl: false }).setView([48.8566, 2.3522], 13); // Default to Paris
        L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager/{z}/{x}/{y}{r}.png').addTo(map);

        // Simulated Mentor Locations
        const mentors = [
            { name: "Sophie", role: "Exchange Mentor", pos: [48.8584, 2.2945] },
            { name: "Ahmed", role: "Housing Expert", pos: [48.8606, 2.3376] }
        ];

        mentors.forEach(m => {
            L.marker(m.pos).addTo(map).bindPopup(`<b>${m.name}</b><br>${m.role}<br><button style="margin-top:5px; border:none; background:#4f46e5; color:white; padding:5px 10px; border-radius:5px; cursor:pointer;">Request Chat</button>`);
        });

        // Search logic
        async function searchCity() {
            const city = document.getElementById('citySearch').value;
            if(!city) return;
            const res = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${city}`);
            const data = await res.json();
            if(data.length > 0) {
                map.flyTo([data[0].lat, data[0].lon], 13);
                // Dynamically update weather placeholder
                document.getElementById('weather').innerHTML = `<i class="fas fa-sun"></i> ${city}, 18¬∞C`;
            }
        }

        // Add to Feed Simulation
        function postToFeed() {
            const msg = prompt("What's the tip or request?");
            if(msg) {
                const feed = document.getElementById('exchangeFeed');
                const div = document.createElement('div');
                div.className = 'feed-item';
                div.innerHTML = `<span class="tag tag-gig">New Request</span><br><strong>Peer Post</strong><p style="font-size:0.85rem; color:#475569;">${msg}</p>`;
                feed.prepend(div);
            }
        }

        // Final UI Polish: Map refresh
        window.onload = () => { setTimeout(() => { map.invalidateSize(); }, 500); };
    </script>
</body>
</html>